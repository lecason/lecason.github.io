<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Swift CoreBluetooth 蓝牙库 | LECASON</title>
  <meta name="author" content="Lecason">
  
  <meta name="description" content="CSBluetoothDemoGithub: CSBluetoothDemoXcode 8 Swift 3 真机环境编译运行
搜索外设123456/// 搜索外设////// - parameter adverisementService: 外设的广告服务字符串/// - parameter ret">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Swift CoreBluetooth 蓝牙库"/>
  <meta property="og:site_name" content="LECASON"/>

  
    <meta property="og:image" content="undefined"/>
  

  
    <link rel="alternative" href="/atom.xml" title="LECASON" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">  
  <link rel="stylesheet" href="/css/sidenav.css" media="screen" type="text/css">  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-50404779-3']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;

ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';

var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>


</head>

<body id="body" data-spy="scroll" data-target=".toc">
  <div class="container" id="container">
	<div class="content">
	  <div class="page-header">		
  <h1><a class="brand" href="/">LECASON</a><span class="split"></span><span class="title">Swift CoreBluetooth 蓝牙库</span><span class="date" id="title-date"><i class="fa fa-clock-o"></i> 2016-09-20</span></h1>
</div>		

<div class="row page">
  <!-- cols -->	
  
  

  
	<div class="col-md-12">
	  

	  <!-- content -->
	  <h1 id="CSBluetoothDemo">CSBluetoothDemo</h1><p>Github: <a href="https://github.com/lecason/CSBluetoothDemo" target="_blank" rel="external">CSBluetoothDemo</a><br>Xcode 8 Swift 3 真机环境编译运行</p>
<h2 id="搜索外设">搜索外设</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 搜索外设</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - parameter adverisementService: 外设的广告服务字符串</span></span><br><span class="line"><span class="comment">/// - parameter retrieveService:     系统已连接上蓝牙所包含的服务</span></span><br><span class="line"><span class="comment">/// - parameter pastLastConnectd:    是否搜索最后一个连接成功的外设</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">scan</span>(<span class="title">adverisementService</span>: [<span class="title">String</span>]?, <span class="title">retrieveService</span>: [<span class="title">String</span>]?, <span class="title">pastLastConnectd</span>: <span class="title">Bool</span>)</span></span><br></pre></td></tr></table></figure>
<p>使用：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CSBluetooth</span>.scan(adverisementService: <span class="literal">nil</span>, retrieveService: [<span class="string">"FF10"</span>], pastLastConnectd: <span class="literal">true</span>)</span><br></pre></td></tr></table></figure></p>
<p>当发现外设的时候：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CSBluetooth</span>.discoverPeripheral = &#123; (peripheral, peripherals) <span class="keyword">in</span></span><br><span class="line"><span class="comment">// peripheral 当前发现的外设</span></span><br><span class="line"><span class="comment">// peripherals 当前已发现的外设</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="连接外设">连接外设</h2><p>连接的时候会，外设如果要输入PIN码，会自动验证PIN码是否输入成功。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 连接外设</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - parameter peripheral: 要连接的外设</span></span><br><span class="line"><span class="comment">/// - parameter success:    连接成功回调</span></span><br><span class="line"><span class="comment">/// - parameter fail:       连接失败回调</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">connectPeripheral</span>(<span class="title">_</span> <span class="title">peripheral</span>: <span class="title">CBPeripheral</span>, <span class="title">success</span>: (@<span class="title">escaping</span> (<span class="title">Swift</span>.<span class="title">Void</span>) -&gt; <span class="title">Swift</span>.<span class="title">Void</span>)?, <span class="title">fail</span>: (@<span class="title">escaping</span> (<span class="title">CSBluetooth</span>.<span class="title">CSBluetoothError</span>) -&gt; <span class="title">Swift</span>.<span class="title">Void</span>)?)</span></span><br></pre></td></tr></table></figure></p>
<p>使用：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CSBluetooth</span>.connectPeripheral(peripheral, success: &#123;&#125;, fail: &#123; (error) <span class="keyword">in</span> <span class="built_in">print</span>(error) &#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="自动重连接外设">自动重连接外设</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 设置断开自动重连外设，用户手动调用断开方法，以及在蓝牙设置里面忽略设备除外。</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - parameter state: 重连级别</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">setAutoReconnectPeripheral</span>(<span class="title">_</span> <span class="title">state</span>: <span class="title">CSBluetoothAutoConnect</span>) </span>&#123;</span><br><span class="line">shareBluetooth.saveAutoConnectPeripheral(state)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CSBluetooth</span>.setAutoReconnectPeripheral(<span class="type">CSBluetoothAutoConnect</span>.switchBluetoothAndFaraway)</span><br></pre></td></tr></table></figure></p>
<h2 id="自动恢复外设">自动恢复外设</h2><p>当APP处于后台时，由于内存紧张或者其它因为APP被系统关闭的时候，系统会在后动重新启动APP，并找回所需要的服务和特征，像手环类APP就可以一直保持在后台保持实时更新当前步数，像蓝牙锁相关的应用就可以长时候在后台运行的时候，被系统关闭了，这时候靠近蓝牙锁就可以自动连接并且实现相应的操作。要求自动重连接设置不可以是<code>CSBluetoothAutoConnect.none</code><br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 要重新恢复需要先在AppDelegate didFinishLaunchingWithOptions调用此方法</span></span><br><span class="line"><span class="comment">/// 并且外设用connectPeripheral(peripheral: CBPeripheral, success:(Void -&gt; Void)?, fail:(Void -&gt; Void)?) 接口成功连接过</span></span><br><span class="line"><span class="comment">/// 且蓝牙与外设断开连接时，不能在系统里面打开和关闭蓝牙，不然就不能在系统杀死APP的时候再恢复连接</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - parameter launchOptions: AppDelegate launchOptions</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">restoreDidFinishLaunchingWithOptions</span>(<span class="title">_</span> <span class="title">launchOptions</span>: [<span class="title">AnyHashable</span> : <span class="title">Any</span>]?)</span></span><br></pre></td></tr></table></figure></p>
<p>使用：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line"><span class="type">CSBluetooth</span>.restoreDidFinishLaunchingWithOptions(launchOptions)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="取消连接外设">取消连接外设</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 取消与外设的连接</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - parameter peripheral: 要取消连接的外设</span></span><br><span class="line"><span class="comment">/// - parameter success:    取消连接成功回调</span></span><br><span class="line"><span class="comment">/// - parameter fail:       取消连接失败回调</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">cancelConnectPeripheral</span>(<span class="title">_</span> <span class="title">peripheral</span>: <span class="title">CBPeripheral</span>, <span class="title">success</span>: (@<span class="title">escaping</span> (<span class="title">Swift</span>.<span class="title">Void</span>) -&gt; <span class="title">Swift</span>.<span class="title">Void</span>)?, <span class="title">fail</span>: (@<span class="title">escaping</span> (<span class="title">CSBluetooth</span>.<span class="title">CSBluetoothError</span>) -&gt; <span class="title">Swift</span>.<span class="title">Void</span>)?)</span></span><br></pre></td></tr></table></figure>
<p>使用：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CSBluetooth</span>.cancelConnectPeripheral(peripheral, success: <span class="literal">nil</span>, fail: &#123; error <span class="keyword">in</span> <span class="built_in">print</span>(error) &#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="读取特征值">读取特征值</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 异步读取特征值</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - parameter readValueIdentifiter: 读特征的标识</span></span><br><span class="line"><span class="comment">/// - parameter success:              读取成功回调</span></span><br><span class="line"><span class="comment">/// - parameter fail:                 读取失败回调</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">readValue</span>(<span class="title">_</span> <span class="title">readValueIdentifiter</span>: <span class="title">String</span>, <span class="title">success</span>: (@<span class="title">escaping</span> (<span class="title">Data</span>) -&gt; <span class="title">Swift</span>.<span class="title">Void</span>)?, <span class="title">fail</span>: (@<span class="title">escaping</span> (<span class="title">CSBluetooth</span>.<span class="title">CSBluetoothError</span>) -&gt; <span class="title">Swift</span>.<span class="title">Void</span>)?)</span></span><br></pre></td></tr></table></figure>
<p>使用：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> read = <span class="type">CSReadCharacteristic</span>(identifier: <span class="string">"READ"</span>, inService: <span class="string">"FEE7"</span>, inCharacteristic: <span class="string">"FEC9"</span>)</span><br><span class="line"><span class="type">CSBluetooth</span>.setReadCharacteristic([read])</span><br><span class="line"><span class="type">CSBluetooth</span>.readValue(<span class="string">"READ"</span>, success: <span class="literal">nil</span>) &#123; (error) <span class="keyword">in</span></span><br><span class="line"><span class="built_in">print</span>(error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CSBluetooth</span>.didReadValue = &#123; chracteristic <span class="keyword">in</span> </span><br><span class="line"><span class="comment">// 得到特征值 chracteristic.value        </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="写特征值">写特征值</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 异步写数据到外设，大于20字节的数据将自动拆分发送，并且会检测每一个分包是否写入成功。</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - parameter data:                  要写入的数据</span></span><br><span class="line"><span class="comment">/// - parameter writeValueIdentifiter: 要写入数据的标识</span></span><br><span class="line"><span class="comment">/// - parameter success:               写入成功回调</span></span><br><span class="line"><span class="comment">/// - parameter fail:                  写入失败回调</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">writeValue</span>(<span class="title">_</span> <span class="title">data</span>: <span class="title">Data</span>, <span class="title">writeValueIdentifiter</span>: <span class="title">String</span>, <span class="title">success</span>: (@<span class="title">escaping</span> (<span class="title">Swift</span>.<span class="title">Void</span>) -&gt; <span class="title">Swift</span>.<span class="title">Void</span>)?, <span class="title">fail</span>: (@<span class="title">escaping</span> (<span class="title">CSBluetooth</span>.<span class="title">CSBluetoothError</span>) -&gt; <span class="title">Swift</span>.<span class="title">Void</span>)?)</span></span><br></pre></td></tr></table></figure>
<p>使用：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> write = <span class="type">CSWriteCharacteristic</span>(identifier: <span class="string">"WRITE"</span>, inService: <span class="string">"FF10"</span>, inCharacteristic: <span class="string">"FF11"</span>)</span><br><span class="line"><span class="type">CSBluetooth</span>.setWriteCharacteristic([write])</span><br><span class="line"><span class="type">CSBluetooth</span>.writeValue([<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>].toData(), writeValueIdentifiter: <span class="string">"WRITE"</span>, success: <span class="literal">nil</span>, fail: &#123; (error) <span class="keyword">in</span> <span class="built_in">print</span>(error) &#125;)</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">将要写入的数据: [&lt;<span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span>&gt;, &lt;<span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">232323</span>&gt;] </span><br><span class="line"></span><br><span class="line">正在写入的数据: &lt;<span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span>&gt; 外设回应数据: &lt;<span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span>&gt;</span><br><span class="line"></span><br><span class="line">写入数据: &lt;<span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span>&gt; 成功</span><br><span class="line"></span><br><span class="line">正在写入的数据: &lt;<span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">232323</span>&gt; 外设回应数据: &lt;<span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">232323</span>&gt;</span><br><span class="line"></span><br><span class="line">写入数据: &lt;<span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">232323</span>&gt; 成功</span><br><span class="line"></span><br><span class="line">写入数据完成: &lt;<span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">23232323</span> <span class="number">232323</span>&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="写特征并回应">写特征并回应</h2><p>适合向外设发送命令，向外设写一条命令，外设在Notify特征里面回应一条命令<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 异步写入数据到外设，每次写入的字节不能大于20字节，写入数据后将会从Notify特征读返回的小于20字节的值，通过校验函数检验是否成功。</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - parameter writeData:             要写入的数据</span></span><br><span class="line"><span class="comment">/// - parameter writeValueIdentifiter: 写特征的标识</span></span><br><span class="line"><span class="comment">/// - parameter vaildFunction:         检验函数，reponseData为Notify特征返回的值</span></span><br><span class="line"><span class="comment">/// - parameter notifyIdentifier:      Notify特征的标识</span></span><br><span class="line"><span class="comment">/// - parameter success:               检验成功回调</span></span><br><span class="line"><span class="comment">/// - parameter fail:                  检验失败回调</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">writeValueWithNofityRespone</span>(<span class="title">_</span> <span class="title">writeData</span>: <span class="title">Data</span>, <span class="title">writeValueIdentifiter</span>: <span class="title">String</span>, <span class="title">vaildFunction</span>: (@<span class="title">escaping</span> (<span class="title">Data</span>) -&gt; <span class="title">Bool</span>), <span class="title">notifyIdentifier</span>: <span class="title">String</span>, <span class="title">success</span>: (@<span class="title">escaping</span> (<span class="title">Swift</span>.<span class="title">Void</span>) -&gt; <span class="title">Swift</span>.<span class="title">Void</span>)?, <span class="title">fail</span>: (@<span class="title">escaping</span> (<span class="title">CSBluetooth</span>.<span class="title">CSBluetoothError</span>) -&gt; <span class="title">Swift</span>.<span class="title">Void</span>)?)</span></span><br></pre></td></tr></table></figure></p>
<p>使用：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> write = <span class="type">CSWriteCharacteristic</span>(identifier: <span class="string">"WRITE"</span>, inService: <span class="string">"FF10"</span>, inCharacteristic: <span class="string">"FF11"</span>)</span><br><span class="line"><span class="type">CSBluetooth</span>.setWriteCharacteristic([write])</span><br><span class="line"><span class="keyword">let</span> notify = <span class="type">CSNotifyCharacteristic</span>(identifier: <span class="string">"NOTIFY"</span>, inService: <span class="string">"FF10"</span>, inCharacteristic: <span class="string">"FF12"</span>, setOn: <span class="literal">true</span>)</span><br><span class="line"><span class="type">CSBluetooth</span>.setNotifyCharacteristic([notify])</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vaildFunction = &#123; (responseData) -&gt; <span class="type">Bool</span> <span class="keyword">in</span></span><br><span class="line"><span class="comment">// Notify特征的值怎么样才算有效的可以自定义在此处理</span></span><br><span class="line"><span class="keyword">return</span> [<span class="number">0x00</span>].toData() != responseData</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">CSBluetooth</span>.writeValueWithNofityRespone([<span class="number">00</span>, <span class="number">00</span>, <span class="number">00</span>, <span class="number">00</span>, <span class="number">09</span>, <span class="number">00</span>, <span class="number">00</span>, <span class="number">00</span>, <span class="number">00</span>, <span class="number">00</span>, <span class="number">00</span>, <span class="number">00</span>, <span class="number">00</span>, <span class="number">00</span>, <span class="number">00</span>, <span class="number">00</span>, <span class="number">00</span>, <span class="number">00</span>, <span class="number">00</span>, <span class="number">00</span>].toData(),writeValueIdentifiter: <span class="string">"WRITE"</span>, vaildFunction: vaildFunction, notifyIdentifier: <span class="string">"NOTIFY"</span>, success: <span class="literal">nil</span>, fail: &#123; (error) <span class="keyword">in</span> <span class="built_in">print</span>(error) &#125;)</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">将要写入的数据: [&lt;<span class="number">00000000</span> <span class="number">09000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>&gt;] </span><br><span class="line"></span><br><span class="line">正在写入的数据: &lt;<span class="number">00000000</span> <span class="number">09000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>&gt; 外设回应数据: &lt;<span class="number">00000000</span> <span class="number">09000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>&gt;</span><br><span class="line"></span><br><span class="line">写入数据: &lt;<span class="number">00000000</span> <span class="number">09000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>&gt; 成功</span><br><span class="line"></span><br><span class="line">写入数据完成: &lt;<span class="number">00000000</span> <span class="number">09000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>&gt; </span><br><span class="line"></span><br><span class="line">正在写入数据: &lt;<span class="number">00000000</span> <span class="number">09000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>&gt; 特征Notify回应数据: Optional(&lt;<span class="number">00000000</span> <span class="number">09000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000009</span>&gt;) </span><br><span class="line"></span><br><span class="line">验证Notify数据成功</span><br></pre></td></tr></table></figure></p>
	  

	  <div>
  		<center>
		  <div class="pagination">
<ul class="pagination">
	
	
	
	
	
		
			
			
		
	
		
			
			
			
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
	
		
	
		
			
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
		
	
	
		<li class="prev disabled"><a><i class="fa fa-arrow-circle-o-left"></i>prev</a></li>
	
	<li><a href="/"><i class="fa fa-archive"></i>Home</a></li>
	
		<li class="next"><a href="/2016/06/27/slides-show/" class="alignright next">next<i class="fa fa-arrow-circle-o-right"></i></a></li>
	
</ul>
</div>

		</center>
	  </div>
	  
	</div> <!-- col-md-9/col-md-12 -->
	
  </div><!-- row -->
<div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES * * */
var disqus_shortname = 'lecason';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>
  </div>
  <div class="container-narrow">
	<footer> <p>
  &copy; 2016 <a href="http://weibo.com/lecason" target="_blank">Lecason</a>
  
with help from <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Bootstrap</a>. Theme base on <a href="http://github.com/wzpan/hexo-theme-wixo/">Wixo</a>.<span id="busuanzi_container_site_pv">
Pv <a><span id="busuanzi_value_site_pv"></span></a> Times.
</span> <span id="busuanzi_container_site_uv">
Uv <a><span id="busuanzi_value_site_uv"></span></a> Times.
</span>
</p>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
 </footer>
  </div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.tableofcontents.min.js"></script>
<script src="/js/tocgenerator.min.js"></script>
<script src="/js/main.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>
