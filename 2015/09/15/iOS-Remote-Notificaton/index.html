<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>iOS 远程通知的实现 | LECASON</title>
  <meta name="author" content="Lecason">
  
  <meta name="description" content="注册推送证书我们的客户端与苹果服务器之间和我们自己的服务器与苹果服务器之间都需要证书来进行链接。下面我们来开始进入证书的制作过程。
生成CSR文件打开MAC - 钥匙串访问 - 菜单 - 证书助理 - 从证书颁发机构请求证书 - 存储到磁盘

注册 App IDs这个是程序要填入的Bundle ID">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="iOS 远程通知的实现"/>
  <meta property="og:site_name" content="LECASON"/>

  
    <meta property="og:image" content="undefined"/>
  

  
    <link rel="alternative" href="/atom.xml" title="LECASON" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">  
  <link rel="stylesheet" href="/css/sidenav.css" media="screen" type="text/css">  
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-50404779-3']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;

ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';

var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>


</head>

<body id="body" data-spy="scroll" data-target=".toc">
  <div class="container" id="container">
	<div class="content">
	  <div class="page-header">		
  <h1><a class="brand" href="/">LECASON</a><span class="split"></span><span class="title">iOS 远程通知的实现</span><span class="date" id="title-date"><i class="fa fa-clock-o"></i> 2015-09-15</span></h1>
</div>		

<div class="row page">
  <!-- cols -->	
  
  

  
	<div class="col-md-12">
	  

	  <!-- content -->
	  <h2 id="注册推送证书">注册推送证书</h2><p>我们的客户端与苹果服务器之间和我们自己的服务器与苹果服务器之间都需要证书来进行链接。下面我们来开始进入证书的制作过程。</p>
<h3 id="生成CSR文件">生成CSR文件</h3><p>打开<code>MAC</code> - <code>钥匙串访问</code> - <code>菜单</code> - <code>证书助理</code> - <code>从证书颁发机构请求证书</code> - <code>存储到磁盘</code></p>
<p><img src="/img/remotenotification1.png" alt=""></p>
<h3 id="注册_App_IDs">注册 App IDs</h3><p>这个是程序要填入的Bundle ID,Explicit App ID是固定一个APP，Wildcard App ID是通用前缀的App</p>
<p>打开<code>developer.apple.com</code> - <code>Idenfifiers</code> - <code>App IDs</code> - <code>+</code> - <code>App ID Description</code> - <code>应用名字</code></p>
<p>App ID Description 写上自己应用名字 </p>
<p><img src="/img/remotenotification3.png" alt=""></p>
<p>Bundle ID 写上应用标识 选择<code>App ID Suffix</code> - <code>Explicit App ID</code> - <code>Bundle ID</code> - <code>App 准备用的Bundle ID</code></p>
<p><img src="/img/remotenotification4.png" alt=""></p>
<p>勾选 通知 选择<code>App Services</code> - <code>勾选</code> - <code>Push Notificatioons</code></p>
<p><img src="/img/remotenotification5.png" alt=""></p>
<p>这时候看到 provisioning profiles 是这样子的</p>
<p><img src="/img/remotenotification6.png" alt=""></p>
<h3 id="注册_Certificates">注册 Certificates</h3><p>开发推送选Apple Push Notification service SSL (Sandbox)，生产环境选Apple Push Notification service SSL (Production)</p>
<p>打开<code>developer.apple.com</code> - <code>Certificates</code> - <code>All</code> - <code>+</code> - <code>Apple Push Notification service SSL (Sandbox)</code> </p>
<p><img src="/img/remotenotification2.png" alt=""></p>
<p>选择上面配置的Bundle ID </p>
<p><img src="/img/remotenotification7.png" alt=""></p>
<p>上传生成的CSR文件</p>
<p><img src="/img/remotenotification8.png" alt=""></p>
<p>下载生成的证书，下载完成后，双击导入证书 <code>aps_development.cer</code></p>
<p><img src="/img/remotenotification9.png" alt=""></p>
<h3 id="注册测试设备_Devices">注册测试设备 Devices</h3><p>打开<code>developer.apple.com</code> - <code>Devices</code> - <code>+</code> 添加要测试的设备</p>
<p><img src="/img/remotenotification10.png" alt=""></p>
<h3 id="生成配置文件并下载_Provisioning_Profiles">生成配置文件并下载 Provisioning Profiles</h3><p>打开<code>developer.apple.com</code> - <code>Provisioning Profiles</code> -<code>All</code> - <code>+</code> </p>
<p>选择 iOS App Development</p>
<p><img src="/img/remotenotification11.png" alt=""></p>
<p>选择 App ID </p>
<p><img src="/img/remotenotification12.png" alt=""></p>
<p>选择证书</p>
<p><img src="/img/remotenotification13.png" alt=""></p>
<p>选择设备</p>
<p><img src="/img/remotenotification14.png" alt=""></p>
<p>添加配置文件名</p>
<p><img src="/img/remotenotification15.png" alt=""></p>
<p>下载保存，并双击配置文件</p>
<p><img src="/img/remotenotification16.png" alt=""></p>
<p>如果不双击导入，会出现下面的错误，还要保证<code>General</code> - <code>Identity</code> - <code>Team</code> 这个Team是创建这个推送证书的Team。</p>
<p><img src="/img/remotenotification20.png" alt=""></p>
<h3 id="导出密钥">导出密钥</h3><p><code>Mac</code> - <code>钥匙串访问</code> - <code>找到我们双击导入的证书</code></p>
<p><img src="/img/remotenotification17.png" alt=""></p>
<p>设置文件名为<code>Push.p12</code>密码 <code>123456</code></p>
<p><img src="/img/remotenotification18.png" alt=""></p>
<h3 id="生成推送PEM文件">生成推送PEM文件</h3><p><code>Mac</code> - <code>终端</code> - <code>切换到刚才证书下载地址</code></p>
<p>把<code>aps_development.cer</code>的SSL证书转换为<code>PushCert.pem</code>文件:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -in aps_development.cer -inform der -out PushCert.pem</span><br></pre></td></tr></table></figure>
<p>把私钥<code>Push.p12</code>文件转化为<code>PushKey.pem</code>文件，在这里要输入原密码<code>123456</code>和设置新密码<code>123456</code>，可以设置不一样。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -nocerts -out PushKey.pem -in Push.p12</span><br></pre></td></tr></table></figure>
<p>对生成的这两个pem文件再生成一个pem文件，来把证书和私钥整合到一个文件里：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat PushCert.pem PushKey.pem &gt; ck.pem</span><br></pre></td></tr></table></figure>
<h2 id="推送测试">推送测试</h2><p>下面我们要使用我们生成的SSL证书和私钥来设置一个安全的链接去链接苹果服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl s_client -connect gateway.sandbox.push.apple.com:<span class="number">2195</span> -cert PushCert.pem -key PushKey.pem</span><br></pre></td></tr></table></figure>
<p>执行完这一句命令后需要我们输入密语<br>Enter pass phrase for PushKey.pem:<br>我们输入<code>123456</code>按回车</p>
<p>返回 <code>Verify return code:0(ok)</code> 就成功了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">CONNECTED(<span class="number">00000003</span>)</span><br><span class="line">depth=<span class="number">1</span> /C=US/O=Entrust, Inc./OU=www.entrust.net/rpa is incorporated by reference/OU=(c) <span class="number">2009</span> Entrust, Inc./CN=Entrust Certification Authority - L1C</span><br><span class="line">verify error:num=<span class="number">20</span>:unable to get <span class="built_in">local</span> issuer certificate</span><br><span class="line">verify <span class="built_in">return</span>:<span class="number">0</span></span><br><span class="line">---</span><br><span class="line">Certificate chain</span><br><span class="line"><span class="number">0</span> s:/C=US/ST=California/L=Cupertino/O=Apple Inc./CN=gateway.sandbox.push.apple.com</span><br><span class="line">i:/C=US/O=Entrust, Inc./OU=www.entrust.net/rpa is incorporated by reference/OU=(c) <span class="number">2009</span> Entrust, Inc./CN=Entrust Certification Authority - L1C</span><br><span class="line"><span class="number">1</span> s:/C=US/O=Entrust, Inc./OU=www.entrust.net/rpa is incorporated by reference/OU=(c) <span class="number">2009</span> Entrust, Inc./CN=Entrust Certification Authority - L1C</span><br><span class="line">i:/O=Entrust.net/OU=www.entrust.net/CPS_2048 incorp. by ref. (limits liab.)/OU=(c) <span class="number">1999</span> Entrust.net Limited/CN=Entrust.net Certification Authority (<span class="number">2048</span>)</span><br><span class="line">---</span><br><span class="line">Server certificate</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">MIIFMzCCBBugAwIBAgIETCMmsDANBgkqhkiG9w0BAQUFADCBsTELMAkGA1UEBhMC</span><br><span class="line">VVMxFjAUBgNVBAoTDUVudHJ1c3QsIEluYy4xOTA3BgNVBAsTMHd3dy5lbnRydXN0</span><br><span class="line">Lm5ldC9ycGEgaXMgaW5jb3Jwb3JhdGVkIGJ5IHJlZmVyZW5jZTEfMB0GA1UECxMW</span><br><span class="line">KGMpIDIwMDkgRW50cnVzdCwgSW5jLjEuMCwGA1UEAxMlRW50cnVzdCBDZXJ0aWZp</span><br><span class="line">Y2F0aW9uIEF1dGhvcml0eSAtIEwxQzAeFw0xNDA1MjMxNzQyNDJaFw0xNjA1MjQw</span><br><span class="line">NzA1MTNaMHQxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRIwEAYD</span><br><span class="line">VQQHEwlDdXBlcnRpbm8xEzARBgNVBAoTCkFwcGxlIEluYy4xJzAlBgNVBAMTHmdh</span><br><span class="line">dGV3YXkuc2FuZGJveC5wdXNoLmFwcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQAD</span><br><span class="line">ggEPADCCAQoCggEBAOQpUlXpU3+LJ2XR01QdVooN7S9OFOINp3/tomPaenQAwFGo</span><br><span class="line">qIakKFcN7AotWLFXFcR0QXKJkn4PL/zPKDBucyRFkc79S5+ZraGRISW<span class="keyword">fi</span>7G8XeaG</span><br><span class="line">G3GzgeVQ977Qrn0IdCswnbwLsJoErnmq4AveQajUbYueR9SxhkWBwMimSxXzXoOS</span><br><span class="line">XUOPzRvzObCxVZrvBBDSRJCeNVnVxtCmb17DM3+z5GZatBwWnvw0jgvSQsgof+uC</span><br><span class="line">idXgqcN4msv3tVH54ipmuD9kbbwvtnDCHBZRXMMmhUfFXZRuE8GBEbPfVkqB16ad</span><br><span class="line">JV4TVrVxwFENwdnsX9CXavHCgFJhtHRWKOoCH48CAwEAAaOCAY0wggGJMAsGA1Ud</span><br><span class="line">DwQEAwIFoDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwMwYDVR0fBCww</span><br><span class="line">KjAooCagJIYiaHR0cDovL2NybC5lbnRydXN0Lm5ldC9sZXZlbDFjLmNybDBkBggr</span><br><span class="line">BgEFBQcBAQRYMFYwIwYIKwYBBQUHMAGGF2h0dHA6Ly9vY3NwLmVudHJ1c3QubmV0</span><br><span class="line">MC8GCCsGAQUFBzAChiNodHRwOi8vYWlhLmVudHJ1c3QubmV0LzIwNDgtbDFjLmNl</span><br><span class="line">cjBKBgNVHSAEQzBBMDUGCSqGSIb2fQdLAjAoMCYGCCsGAQUFBwIBFhpodHRwOi8v</span><br><span class="line">d3d3LmVudHJ1c3QubmV0L3JwYTAIBgZngQwBAgIwKQYDVR0RBCIwIIIeZ2F0ZXdh</span><br><span class="line">eS5zYW5kYm94LnB1c2guYXBwbGUuY29tMB8GA1UdIwQYMBaAFB7xq4kG+EkPATN3</span><br><span class="line"><span class="number">7</span>hR67hl8kyhNMB0GA1UdDgQWBBSSGfpGPmr9+FPcqRiStH0iKRBL7DAJBgNVHRME</span><br><span class="line">AjAAMA0GCSqGSIb3DQEBBQUAA4IBAQAkj6+okMFVl7NHqQoii4e4iPDFiia+LmHX</span><br><span class="line">BCc+<span class="number">2</span>UEOOjilYWYoZ61oeqRXQ2b4Um3dT/LPmzMkKmgEt9epKNBLA6lSkL+IzEnF</span><br><span class="line">wLQCHkL3BgvV20n5D8syzREV+<span class="number">8</span>RKmSqiYmrF8dFq8cDcstu2joEKd173EfrymWW1</span><br><span class="line">fMeaYTbjrn+vNkgM94+M4c/JnIDOhiPPbeAx9TESQZH+/<span class="number">6</span>S98hrbuPIIlmaOJsOT</span><br><span class="line">GMOUWeOTHXTCfGb1EM4SPVcyCW28TlWUBl8miqnsEO8g95jZZ25wFANlVxhfxBnP</span><br><span class="line">fwUYU5NTM3h0xi3rIlXwAKD6zLKipcQ/YXRx7oMYnAm53tfU2MxV</span><br><span class="line">-----END CERTIFICATE-----</span><br><span class="line">subject=/C=US/ST=California/L=Cupertino/O=Apple Inc./CN=gateway.sandbox.push.apple.com</span><br><span class="line">issuer=/C=US/O=Entrust, Inc./OU=www.entrust.net/rpa is incorporated by reference/OU=(c) <span class="number">2009</span> Entrust, Inc./CN=Entrust Certification Authority - L1C</span><br><span class="line">---</span><br><span class="line">Acceptable client certificate CA names</span><br><span class="line">/C=US/O=Apple Inc./OU=Apple Certification Authority/CN=Apple Root CA</span><br><span class="line">/C=US/O=Apple Inc./OU=Apple Worldwide Developer Relations/CN=Apple Worldwide Developer Relations Certification Authority</span><br><span class="line">/C=US/O=Apple Inc./OU=Apple Certification Authority/CN=Apple Application Integration Certification Authority</span><br><span class="line">---</span><br><span class="line">SSL handshake has <span class="built_in">read</span> <span class="number">3160</span> bytes and written <span class="number">2155</span> bytes</span><br><span class="line">---</span><br><span class="line">New, TLSv1/SSLv3, Cipher is AES256-SHA</span><br><span class="line">Server public key is <span class="number">2048</span> bit</span><br><span class="line">Secure Renegotiation IS supported</span><br><span class="line">Compression: NONE</span><br><span class="line">Expansion: NONE</span><br><span class="line">SSL-Session:</span><br><span class="line">Protocol  : TLSv1</span><br><span class="line">Cipher    : AES256-SHA</span><br><span class="line">Session-ID: </span><br><span class="line">Session-ID-ctx: </span><br><span class="line">Master-Key: <span class="number">208</span>E318208EB463C7F924DFDA0E80C82FC7A6B04CE89FE7AE0D99C789DE653F20F6B7FB8073C3DBBF6ED74F90A4B389D</span><br><span class="line">Key-Arg   : None</span><br><span class="line">Start Time: <span class="number">1442292792</span></span><br><span class="line">Timeout   : <span class="number">300</span> (sec)</span><br><span class="line">Verify <span class="built_in">return</span> code: <span class="number">0</span> (ok)</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<h2 id="项目测试">项目测试</h2><p>建立我们的推送的项目 <em><code>注意Bundle Identifier必须和我们推送应用的Bundle Identifier一致</code></em></p>
<p><img src="/img/remotenotification19.png" alt=""></p>
<p>iOS 8 以上在AppDelegate获得远程通知权限并注册的方法：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 注册远程通知</span></span><br><span class="line">    <span class="built_in">UIUserNotificationType</span> types = <span class="built_in">UIUserNotificationTypeBadge</span> |</span><br><span class="line">    <span class="built_in">UIUserNotificationTypeSound</span> | <span class="built_in">UIUserNotificationTypeAlert</span>;</span><br><span class="line">    <span class="built_in">UIUserNotificationSettings</span> *mySettings =</span><br><span class="line">    [<span class="built_in">UIUserNotificationSettings</span> settingsForTypes:types categories:<span class="literal">nil</span>];</span><br><span class="line">    [[<span class="built_in">UIApplication</span> sharedApplication] registerUserNotificationSettings:mySettings];</span><br><span class="line">    [[<span class="built_in">UIApplication</span> sharedApplication] registerForRemoteNotifications];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取DeviceToken成功</span></span><br><span class="line">- (<span class="keyword">void</span>)application:(<span class="built_in">UIApplication</span> *)application</span><br><span class="line">didRegisterForRemoteNotificationsWithDeviceToken:(<span class="built_in">NSData</span> *)deviceToken</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"DeviceToken : %@"</span>,deviceToken);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册消息推送失败</span></span><br><span class="line">- (<span class="keyword">void</span>)application:(<span class="built_in">UIApplication</span> *)application</span><br><span class="line">didFailToRegisterForRemoteNotificationsWithError:(<span class="built_in">NSError</span> *)error</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Register Remote Notifications error : %@"</span>,error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理收到的消息推送</span></span><br><span class="line">- (<span class="keyword">void</span>)application:(<span class="built_in">UIApplication</span> *)application</span><br><span class="line">didReceiveRemoteNotification:(<span class="built_in">NSDictionary</span> *)userInfo</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Receive remote notification : %@"</span>,userInfo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>完成后，启动一次App,申请权限 </p>
<p><img src="/img/remotenotification21.jpg" alt=""></p>
<p>新建一个和<code>ck.pem</code>在同一个目录下的<code>push.php</code>文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Put your device token here (without spaces):</span></span><br><span class="line"><span class="variable">$deviceToken</span> = <span class="string">'74314cc9e8f747e2fa96c2c1585c830cdf994de6b453ce9fa1c09ba396b2f9e9'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Put your private key's passphrase here:</span></span><br><span class="line"><span class="variable">$passphrase</span> = <span class="string">'123456'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Put your alert message here:</span></span><br><span class="line"><span class="variable">$message</span> = <span class="string">'这是一条推送消息'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$ctx</span> = stream_context_create();</span><br><span class="line">stream_context_set_option(<span class="variable">$ctx</span>, <span class="string">'ssl'</span>, <span class="string">'local_cert'</span>, <span class="string">'ck.pem'</span>);</span><br><span class="line">stream_context_set_option(<span class="variable">$ctx</span>, <span class="string">'ssl'</span>, <span class="string">'passphrase'</span>, <span class="variable">$passphrase</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Open a connection to the APNS server</span></span><br><span class="line"><span class="variable">$fp</span> = stream_socket_client(</span><br><span class="line"><span class="string">'ssl://gateway.sandbox.push.apple.com:2195'</span>, <span class="variable">$err</span>,</span><br><span class="line"><span class="variable">$errstr</span>, <span class="number">60</span>, STREAM_CLIENT_CONNECT|STREAM_CLIENT_PERSISTENT, <span class="variable">$ctx</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$fp</span>)</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">"Failed to connect: $err $errstr"</span> . PHP_EOL);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Connected to APNS'</span> . PHP_EOL;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create the payload body</span></span><br><span class="line"><span class="variable">$body</span>[<span class="string">'aps'</span>] = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">'alert'</span> =&gt; <span class="variable">$message</span>,</span><br><span class="line"><span class="string">'sound'</span> =&gt; <span class="string">'default'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Encode the payload as JSON</span></span><br><span class="line"><span class="variable">$payload</span> = json_encode(<span class="variable">$body</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Build the binary notification</span></span><br><span class="line"><span class="variable">$msg</span> = chr(<span class="number">0</span>) . pack(<span class="string">'n'</span>, <span class="number">32</span>) . pack(<span class="string">'H*'</span>, <span class="variable">$deviceToken</span>) . pack(<span class="string">'n'</span>, strlen(<span class="variable">$payload</span>)) . <span class="variable">$payload</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Send it to the server</span></span><br><span class="line"><span class="variable">$result</span> = fwrite(<span class="variable">$fp</span>, <span class="variable">$msg</span>, strlen(<span class="variable">$msg</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$result</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Message not delivered'</span> . PHP_EOL;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Message successfully delivered'</span> . PHP_EOL;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Close the connection to the server</span></span><br><span class="line">fclose(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>切换到<code>push.php</code>所在目录,输入命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php push.php</span><br></pre></td></tr></table></figure>
<p>提示下面信息就可以收到推送了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Lecasons-RMBP:Push lecason$ php push.php</span><br><span class="line">Connected to APNS</span><br><span class="line">Message successfully delivered</span><br><span class="line">Lecasons-RMBP:Push lecason$</span><br></pre></td></tr></table></figure>
<p>这时候手机就可以收到推送消息了，测试效果：</p>
<p><img src="/img/remotenotification22.jpg" alt=""></p>
<h2 id="个推测试">个推测试</h2><p>新建一个<code>App</code> <code>应用标识</code> 要和 <code>Bundle ID</code> 一致</p>
<p><img src="/img/remotenotification23.png" alt=""></p>
<p>参考<a href="http://docs.igetui.com/pages/viewpage.action?pageId=1934126" target="_blank" rel="external">个推官方集成文档</a>集成到我们的应用里面。</p>
<p>导入<code>dist</code>文件夹和<code>所有的库文件</code>后，填好从个推上申请到的<code>AppId</code> <code>AppKey</code> <code>AppSecret</code></p>
<p><code>AppDelegate.h</code>:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"GeTuiSdk.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#define kAppId           @<span class="title">"PntQOqaY8H69wtmvYYjBJA"</span></span></span><br><span class="line"><span class="preprocessor">#define kAppKey          @<span class="title">"v3evaqV8Ll8DNJeb4f5o74"</span></span></span><br><span class="line"><span class="preprocessor">#define kAppSecret       @<span class="title">"82KMEAqBWt6Bntxz2L9Wd8"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AppDelegate</span> : <span class="title">UIResponder</span> &lt;<span class="title">UIApplicationDelegate</span>,<span class="title">GeTuiSdkDelegate</span>&gt; </span>&#123;</span><br><span class="line"><span class="keyword">@private</span></span><br><span class="line"><span class="built_in">NSString</span> *_deviceToken;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIWindow</span> *window;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (retain, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *appKey;</span><br><span class="line"><span class="keyword">@property</span> (retain, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *appSecret;</span><br><span class="line"><span class="keyword">@property</span> (retain, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *appID;</span><br><span class="line"><span class="keyword">@property</span> (retain, <span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *clientId;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>AppDelegate.m</code>:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">"AppDelegate.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AppDelegate</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#define NotifyActionKey <span class="title">"NotifyAction"</span></span></span><br><span class="line"><span class="built_in">NSString</span>* <span class="keyword">const</span> NotificationCategoryIdent  = <span class="string">@"ACTIONABLE"</span>;</span><br><span class="line"><span class="built_in">NSString</span>* <span class="keyword">const</span> NotificationActionOneIdent = <span class="string">@"ACTION_ONE"</span>;</span><br><span class="line"><span class="built_in">NSString</span>* <span class="keyword">const</span> NotificationActionTwoIdent = <span class="string">@"ACTION_TWO"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// [1]:使用APPID/APPKEY/APPSECRENT创建个推实例</span></span><br><span class="line">    [<span class="keyword">self</span> startSdkWith:kAppId appKey:kAppKey appSecret:kAppSecret];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [2]:注册APNS</span></span><br><span class="line">    [<span class="keyword">self</span> registerRemoteNotification];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)registerRemoteNotification </span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ([[[<span class="built_in">UIDevice</span> currentDevice] systemVersion] floatValue] &gt;= <span class="number">8.0</span>) &#123;</span><br><span class="line">        <span class="comment">//IOS8 新的通知机制category注册</span></span><br><span class="line">        <span class="built_in">UIMutableUserNotificationAction</span> *action1;</span><br><span class="line">        action1 = [[<span class="built_in">UIMutableUserNotificationAction</span> alloc] init];</span><br><span class="line">        [action1 setActivationMode:<span class="built_in">UIUserNotificationActivationModeBackground</span>];</span><br><span class="line">        [action1 setTitle:<span class="string">@"取消"</span>];</span><br><span class="line">        [action1 setIdentifier:NotificationActionOneIdent];</span><br><span class="line">        [action1 setDestructive:<span class="literal">NO</span>];</span><br><span class="line">        [action1 setAuthenticationRequired:<span class="literal">NO</span>];</span><br><span class="line"></span><br><span class="line">        <span class="built_in">UIMutableUserNotificationAction</span> *action2;</span><br><span class="line">        action2 = [[<span class="built_in">UIMutableUserNotificationAction</span> alloc] init];</span><br><span class="line">        [action2 setActivationMode:<span class="built_in">UIUserNotificationActivationModeBackground</span>];</span><br><span class="line">        [action2 setTitle:<span class="string">@"回复"</span>];</span><br><span class="line">        [action2 setIdentifier:NotificationActionTwoIdent];</span><br><span class="line">        [action2 setDestructive:<span class="literal">NO</span>];</span><br><span class="line">        [action2 setAuthenticationRequired:<span class="literal">NO</span>];</span><br><span class="line"></span><br><span class="line">        <span class="built_in">UIMutableUserNotificationCategory</span> *actionCategory;</span><br><span class="line">        actionCategory = [[<span class="built_in">UIMutableUserNotificationCategory</span> alloc] init];</span><br><span class="line">        [actionCategory setIdentifier:NotificationCategoryIdent];</span><br><span class="line">        [actionCategory setActions:@[action1, action2]</span><br><span class="line">        forContext:<span class="built_in">UIUserNotificationActionContextDefault</span>];</span><br><span class="line"></span><br><span class="line">        <span class="built_in">NSSet</span> *categories = [<span class="built_in">NSSet</span> setWithObject:actionCategory];</span><br><span class="line">        <span class="built_in">UIUserNotificationType</span> types = (<span class="built_in">UIUserNotificationTypeAlert</span>|</span><br><span class="line">        <span class="built_in">UIUserNotificationTypeSound</span>|</span><br><span class="line">        <span class="built_in">UIUserNotificationTypeBadge</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">UIUserNotificationSettings</span> *settings;</span><br><span class="line">        settings = [<span class="built_in">UIUserNotificationSettings</span> settingsForTypes:types categories:categories];</span><br><span class="line">        [[<span class="built_in">UIApplication</span> sharedApplication] registerForRemoteNotifications];</span><br><span class="line">        [[<span class="built_in">UIApplication</span> sharedApplication] registerUserNotificationSettings:settings];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取DeviceToken成功</span></span><br><span class="line">- (<span class="keyword">void</span>)application:(<span class="built_in">UIApplication</span> *)application didRegisterForRemoteNotificationsWithDeviceToken:(<span class="built_in">NSData</span>*)deviceToken</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *token = [[deviceToken description] stringByTrimmingCharactersInSet:[<span class="built_in">NSCharacterSet</span> characterSetWithCharactersInString:<span class="string">@"&lt;&gt;"</span>]];</span><br><span class="line">    _deviceToken = [token stringByReplacingOccurrencesOfString:<span class="string">@" "</span> withString:<span class="string">@""</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"deviceToken:%@"</span>, _deviceToken);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [3]:向个推服务器注册deviceToken</span></span><br><span class="line">    [GeTuiSdk registerDeviceToken:_deviceToken];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)GeTuiSdkDidRegisterClient:(<span class="built_in">NSString</span> *)clientId</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// [4-EXT-1]: 个推SDK已注册，返回clientId</span></span><br><span class="line">    <span class="keyword">if</span> (_deviceToken) &#123;</span><br><span class="line">        [GeTuiSdk registerDeviceToken:_deviceToken];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册消息推送失败</span></span><br><span class="line">- (<span class="keyword">void</span>)application:(<span class="built_in">UIApplication</span> *)application</span><br><span class="line">didFailToRegisterForRemoteNotificationsWithError:(<span class="built_in">NSError</span> *)error</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Register Remote Notifications error : %@"</span>,error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理收到的消息推送</span></span><br><span class="line">- (<span class="keyword">void</span>)application:(<span class="built_in">UIApplication</span> *)application</span><br><span class="line">didReceiveRemoteNotification:(<span class="built_in">NSDictionary</span> *)userInfo</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Receive remote notification : %@"</span>,userInfo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)startSdkWith:(<span class="built_in">NSString</span> *)appID appKey:(<span class="built_in">NSString</span> *)appKey appSecret:(<span class="built_in">NSString</span> *)appSecret</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSError</span> *err = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//[1-1]:通过 AppId、 appKey 、appSecret 启动SDK</span></span><br><span class="line">    [GeTuiSdk startSdkWithAppId:appID appKey:appKey appSecret:appSecret delegate:<span class="keyword">self</span> error:&amp;err];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//[1-2]:设置是否后台运行开关</span></span><br><span class="line">    [GeTuiSdk runBackgroundEnable:<span class="literal">YES</span>];</span><br><span class="line">    <span class="comment">//[1-3]:设置电子围栏功能，开启LBS定位服务 和 是否允许SDK 弹出用户定位请求</span></span><br><span class="line">    [GeTuiSdk lbsLocationEnable:<span class="literal">YES</span> andUserVerify:<span class="literal">YES</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)applicationDidEnterBackground:(<span class="built_in">UIApplication</span> *)application</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">// [EXT] APP进入后台时，通知个推SDK进入后台</span></span><br><span class="line">    [GeTuiSdk enterBackground];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>运行APP，成功后会提示</p>
<p><img src="/img/remotenotification24.png" alt=""></p>
<p>发送透传消息</p>
<p><img src="/img/remotenotification25.png" alt=""></p>
<p>iPhone 收到推送消息的效果：</p>
<p><img src="/img/remotenotification26.png" alt=""></p>
	  

	  <div>
  		<center>
		  <div class="pagination">
<ul class="pagination">
	
	
	
	
	
		
			
		
	
		
			
		
	
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
			
		
	
		
	
		
			
		
	
		
	
		
			
		
	
		
			
		
	
		
	
		
			
		
	
		
			
		
	
		
	
		
			
		
	
		
	
		
			
		
	
		
	
		
			
		
	
		
	
		
	
		
			
		
	
		
			
		
	
		
	
		
	
		
	
		
			
			
		
	
		
	
		
			
			
			
		
			
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
	
		
			
		
	
		
			
		
	
		
	
		
	
		
			
		
	
		
	
		
			
		
	
		
	
		
	
		
	
		
			
		
	
		
			
		
	
		
	
	
		<li class="prev"><a href="/2015/09/18/iOS-Reset-Label-line-Space-Head-Index/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>prev</a></li>
	
	<li><a href="/"><i class="fa fa-archive"></i>Home</a></li>
	
		<li class="next"><a href="/2015/09/11/iOS-Custom-backBarButtonItem/" class="alignright next">next<i class="fa fa-arrow-circle-o-right"></i></a></li>
	
</ul>
</div>

		</center>
	  </div>
	  
	</div> <!-- col-md-9/col-md-12 -->
	
  </div><!-- row -->
<div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES * * */
var disqus_shortname = 'lecason';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>
  </div>
  <div class="container-narrow">
	<footer> <p>
  &copy; 2015 <a href="http://weibo.com/lecason" target="_blank">Lecason</a>
  
with help from <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Bootstrap</a>. Theme base on <a href="http://github.com/wzpan/hexo-theme-wixo/">Wixo</a>.<span id="busuanzi_container_site_pv">
Pv <a><span id="busuanzi_value_site_pv"></span></a> Times.
</span> <span id="busuanzi_container_site_uv">
Uv <a><span id="busuanzi_value_site_uv"></span></a> Times.
</span>
</p>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
 </footer>
  </div> <!-- container-narrow -->
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.tableofcontents.min.js"></script>
<script src="/js/tocgenerator.min.js"></script>
<script src="/js/main.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>
